$(function(){var h,k,e,d;$(document).on("focus",".input:not(:disabled)",function(){mobserv.inputfocus=$(this)}).on("blur",".input:not(:disabled)",function(){mobserv.inputfocus=null}).on("submit","form",function(a){var b=$(this),c=b.find(".command");if(c.length){var f=c.val().toLowerCase(),l=!1;"debug:on"==f&&(mobserv.debug.on(),c.val(""),l=!0);"debug:off"==f&&(mobserv.debug.off(),c.val(""),l=!0);"sqlite:reset"==f&&(mobserv.sqlite.clear(),mobserv.sqlite.create(),c.val(""),l=!0);"app:reset"==f&&(mobserv.sqlite.clear(),
mobserv.sqlite.create(),location.reload(!0),l=!0);if("app:restart"==f||"app:reload"==f)location.reload(!0),l=!0;if(l)return!1}var e=!0,d={};b.find('.input:visible:not(:disabled,.disable), input[type="hidden"]:not(:disabled,.disable)').each(function(){var a=$(this);d[a.attr("name")]=a.val();if(!a.val()&&!0===a.prop("required"))return console.error(a.attr("name"),a.prop("required"),a.val()),a.addClass("invalid"),e=!1});e?b.trigger("send",[d]):mobserv.notify.open({type:"error",name:"Formul\u00e1rio",
message:"Os campos s\u00e3o requiridos"});mobserv.inputfocus&&!mobserv.inputfocus.data("preventcloseonsubmit")&&mobserv.keyboard.close();a.preventDefault();return!1}).on("send","#formclient",function(){var a=mobserv.globals.client,b=$(this);b.find(".submit");a.install=$.md5(mobserv.device.data.uuid);a.code=b.find("#cid").val().toLowerCase();a.password=b.find("#cpw").val()?$.md5(b.find("#cpw").val()):"";if(a.code&&a.password){var c={exec:"getLicense","in":a.install,cid:a.code,pw:a.password};b.find(".input, .submit").addClass("courtain disable").prop("disabled",
!0);mobserv.sqlite.query('select * from sl_clients where code = "'+a.code+'"',function(a){mobserv.auth.client(a,c,function(a){mobserv.nav.toView("formuser");b.find(".input, .submit").removeClass("courtain");b.find(".input").val("");mobserv.notify.open({type:"info",name:"Valida\u00e7\u00e3o de Cliente",message:a})},function(){b.find(".input, .submit").removeClass("courtain disable").prop("disabled",!1)})})}}).on("send","#formuser",function(){var a=mobserv.globals.client,b=mobserv.globals.user,c=$(this);
c.find(".submit");b.login=c.find("#us").val().toLowerCase();b.password=c.find("#upw").val()?$.md5(c.find("#upw").val()):"";if(a.code&&a.password){var f={exec:"authUser",lc:a.license,"in":a.install,cid:a.code,us:b.login,pw:b.password};c.find(".input, .submit").addClass("courtain disable").prop("disabled",!0);mobserv.sqlite.query('select * from sl_users where login = "'+b.login+'"',function(a){mobserv.auth.user(a,f,function(a){$(".footer").transition({y:0},300);mobserv.nav.toView("home");c.find(".input, .submit").removeClass("courtain");
c.find(".input").val("");mobserv.notify.open({type:"info",name:"Autentica\u00e7\u00e3o de Usu\u00e1rio",message:a});mobserv.services.init(function(){mobserv.services.get(function(){mobserv.talkies.init(function(){mobserv.talkies.get()})})})},function(){c.find(".input, .submit").removeClass("courtain disable").prop("disabled",!1)})})}else mobserv.notify.open({type:"error",name:"Formul\u00e1rio",message:"Os campos s\u00e3o requiridos"})}).on("input",".view:visible .search #search",function(){var a=
$(this),b=a.parent(),c=b.next(".list").children("li"),f=a.val().toLowerCase();if(c.length)if(""==f)c.removeClass("found").show();else{c.removeClass("found");if("service"==b.data("target"))a=mobserv.globals.services.xml,b=$(a),$search=b.find("service");else if("job"==b.data("target"))a=mobserv.globals.services.xml,b=$(a),$search=b.find("job");else if("message"==b.data("target"))a=mobserv.globals.talkies.xml,b=$(a),$search=b.find("talk");else return!1;a&&$search.length&&($search.each(function(){var a=
$(this);-1<a.text().toLowerCase().indexOf(f)&&c.children('.link[data-id="'+a.attr("id")+'"]').parent().addClass("found").show()}),c.filter(":not(.found)").hide())}}).on("send","#jobdetails:visible .jobform",function(a,b){var c=$(this).closest(".view").addClass("courtain"),f=c.find(".section").hide();b.isPost=!0;mobserv.services.post(b,function(){c.removeClass("courtain");f.show()})}).on("send","#messages:visible .composer",function(a,b){var c=$(this),f=c.closest(".view"),e=c.prev(".forchat").find(".chat:eq(0)");
if(b.message){c.find(".input").val("");var f={message:{id:$.md5(mobserv.now("timestamp")+mobserv.device.data.uuid+f.data("id")+b.message),text:b.message,talk:f.data("id")},isPost:!0,exec:"postTalkieMessage"},d='<div class="talk me courtain" id="'+f.message.id+'"><div class="text">'+f.message.text+'</div><div class="info"><span class="icon-clock">'+mobserv.now("time")+'</span></div></div><div class="clear"></div>',d=$(d);e.append(d.css({opacity:0,transform:"scale(0.1,0.1)"}));c.prev(".forchat").scrollTop(999999999);
d.transition({opacity:1,scale:1.1},200,function(){d.transition({scale:1},150)});mobserv.talkies.post(f,function(){d.removeClass("courtain")},function(){d.removeClass("courtain").addClass("error")})}}).on("tap","#messages:visible .composer .submit",function(a,b){$(this).closest("form").submit();a.preventDefault();a.stopPropagation()}).on("tap","#confirmexit .exit",function(){mobserv.exit()}).on("tap","#formuser .logoutclient",function(){mobserv.nav.toView("formclient")}).on("tap","#formclient .input:not(:disabled), #formuser .input:not(:disabled)",
function(a){$(this).focus().removeClass("invalid");a.preventDefault();a.stopPropagation()}).on("tap",".input:not(:disabled)",function(a){$(this).focus().removeClass("invalid")}).on("change input",".input:not(:disabled)",function(){$(this).removeClass("invalid")}).on("tap","form.search, form.composer",function(){$(this).find(".input").prop("disabled",!1).focus()}).on("blur focusout",".search .input, .composer .input",function(){var a=$(this);setTimeout(function(){a.prop("disabled",!0)},300)}).on("touchstart",
function(a){$(".hover").removeClass("hover")}).on("tap","#nav a",function(){var a=$(this).addClass("hover");$(".view.current").find(".header, .section").transition({opacity:1},1E3);$(".footer").transition({y:0},300);mobserv.nav.link(a);$(".view.current").transition({x:0},300,function(){$("#nav").removeClass("active");$(".view.disable").removeClass("disable")})}).on("tap",".view:not(.disable) section a, .view:not(.disable) form .link, .view:not(.disable) section .link, .view:not(.disable) header .link, footer .link, .overall button",
function(){var a=$(this).addClass("hover");mobserv.nav.link(a)}).on("tap",".overall button",function(){var a=$(this).addClass("hover").closest(".view");mobserv.nav.close(a)}).on("tap",".view:not(.disable) .menu",function(){$(this).addClass("hover");$("#nav").hasClass("active")||($(".footer").transition({y:"50px"},300),$("#nav").addClass("active"),$(".view.current").addClass("disable").transition({x:"-80%"},300).find(".header, .section").transition({opacity:.3},300))}).on("tap","#confirmremovelog button.remove",
function(){mobserv.unlog()}).on("tap","#confirmremovemessages button.remove",function(){var a=$(this).closest(".view");mobserv.talkies.remove(a.data("id"))}).on("tap",".view.disable",function(){$("#nav").hasClass("active")&&($(".footer").transition({y:0},300),$(".view.current").transition({x:0},300,function(){$(".view.disable").removeClass("disable");$("#nav").removeClass("active")}).find(".header, .section").transition({opacity:1},300))}).on("tap","#messages .chat",function(){mobserv.keyboard.close()}).on("touchstart",
".view.current .pullarea",function(a){1==a.originalEvent.touches.length&&(h=a.originalEvent.touches[0].pageY,e=$(this),"u"!=e.data("moved")&&(d=e.prev().removeClass("courtain").find("strong").text("Solte para atualizar")))}).on("touchmove",".view.current .pullarea",function(a){k=a.originalEvent.touches[0].pageY;var b=e.parent();"u"!=e.data("moved")&&5>b.scrollTop()&&k>h+15&&(a.preventDefault(),a.stopPropagation(),b.scrollTop(0).addClass("noscroll"),a=parseInt((k-h)/2.3),b=$(window).height()/4,e.css({transform:"translate(0px, "+
a+"px)"}).data("moved","y"),d.css({transform:"translate(0px, "+a/2+"px)",opacity:a/b}))}).on("touchend",".view.current .pullarea",function(a){e.parent().removeClass("noscroll");"y"==e.data("moved")&&(e.data("moved","u"),a.preventDefault(),a.stopPropagation(),h+$(window).height()/2>k?(e.transition({y:0},250,function(){e.data("moved","")}),d.transition({y:0,opacity:0},250)):(e.transition({y:40},250,function(){d.parent().addClass("courtain");d.text("Atualizando...");e.trigger("pull")}),d.transition({y:20,
opacity:1},250)));k=h=null}).on("pull",".view#home .pullarea",function(a){mobserv.services.get(function(){mobserv.talkies.get(function(){e.data("moved","");e.transition({y:0},300);d.transition({y:0,opacity:0},300);d.parent().removeClass("courtain");d.text("Conclu\u00eddo");d=e=null})})}).on("pull",".view#servicelist .pullarea, .view#joblist .pullarea",function(a){mobserv.services.get(function(){e.data("moved","");e.transition({y:0},300);d.transition({y:0,opacity:0},300);d.parent().removeClass("courtain");
d.text("Conclu\u00eddo");d=e=null})}).on("pull",".view#talkies .pullarea",function(a){mobserv.talkies.get(function(){e.data("moved","");e.transition({y:0},300);d.transition({y:0,opacity:0},300);d.parent().removeClass("courtain");d.text("Conclu\u00eddo");d=e=null})}).on("pull",".view#messages .pullarea",function(a){mobserv.talkies.get(function(){e.data("moved","");e.transition({y:0},300);d.transition({y:0,opacity:0},300);d.parent().removeClass("courtain");d.text("Conclu\u00eddo");d=e=null})}).on("show",
".view",function(){var a=$(this);mobserv.keyboard.close();0==mobserv.history.length?a.find(".header .back").hide():a.find(".header .back").show()}).on("show","#formuser",function(){var a=$(this);$(".footer").transition({y:"50px"},300);mobserv.auth.logout("user");a.find("button, .button, .submit, .input").removeClass("courtain disable").prop("disabled",!1);a.find(".input").val("")}).on("show","#formclient",function(){var a=$(this);$(".footer").transition({y:"50px"},300);mobserv.auth.logout();a.find("button, .button, .submit, .input").removeClass("courtain disable").prop("disabled",
!1);a.find(".input").val("")}).on("show","#datasource",function(){var a=$(this),b="",c="",d="";"service"==a.data("source")?(mobserv.globals.services.cache&&(b=(new XMLSerializer).serializeToString(mobserv.globals.services.cache)),mobserv.globals.services.response&&(c=(new XMLSerializer).serializeToString(mobserv.globals.services.response)),mobserv.globals.services.xml&&(d=(new XMLSerializer).serializeToString(mobserv.globals.services.xml))):"user"==a.data("source")?(mobserv.globals.user.cache&&(b=
(new XMLSerializer).serializeToString(mobserv.globals.user.cache)),mobserv.globals.user.response&&(c=(new XMLSerializer).serializeToString(mobserv.globals.user.response)),mobserv.globals.user.xml&&(d=(new XMLSerializer).serializeToString(mobserv.globals.user.xml))):"client"==a.data("source")?(mobserv.globals.client.cache&&(b=(new XMLSerializer).serializeToString(mobserv.globals.client.cache)),mobserv.globals.client.response&&(c=(new XMLSerializer).serializeToString(mobserv.globals.client.response)),
mobserv.globals.client.xml&&(d=(new XMLSerializer).serializeToString(mobserv.globals.client.xml))):"talkies"==a.data("source")&&(mobserv.globals.talkies.cache&&(b=(new XMLSerializer).serializeToString(mobserv.globals.talkies.cache)),mobserv.globals.talkies.response&&(c=(new XMLSerializer).serializeToString(mobserv.globals.talkies.response)),mobserv.globals.talkies.xml&&(d=(new XMLSerializer).serializeToString(mobserv.globals.talkies.xml)));a.find("#header .icon-code").html(a.data("source"));a.find("code.xml").each(function(a,
e){var g=$(e);g.hasClass("cache")?g.text(b):g.hasClass("response")?g.text(c):g.text(d);hljs.highlightBlock(e)})}).on("show","#joblist",function(){$(this).addClass("courtain").find(".section").hide();mobserv.services.cleardom("joblist")}).on("current","#joblist",function(){var a=$(this).removeClass("courtain");mobserv.services.parsedom("joblist",a.data("id"));a.find(".section").fadeIn(200)}).on("show","#jobdetails",function(){$(this).addClass("courtain").find(".section").hide();mobserv.services.cleardom("jobdetails")}).on("current",
"#jobdetails",function(){var a=$(this).removeClass("courtain");mobserv.services.parsedom("jobdetails",a.data("id"));a.find(".section").fadeIn(200)}).on("show","#messages",function(){var a=$(this).addClass("courtain");a.find(".section").hide();mobserv.talkies.cleardom("messages");mobserv.talkies.read(a.data("id"))}).on("current","#messages",function(){var a=$(this).removeClass("courtain");mobserv.talkies.parsedom("messages",a.data("id"));a.find(".section").fadeIn(200).scrollTop(999999999);mobserv.talkies.autogetspeed=
.1;mobserv.talkies.autoreset()}).on("hide","#messages",function(){mobserv.talkies.autogetspeed=1;mobserv.talkies.autoreset()}).on("current","#gps",function(){mobserv.geolocation.getPosition()}).on("show","#map",function(){var a=$(this);a.find(".mapdata").hide();a.find(".jobdata").hide()}).on("current","#map",function(){function a(a,b,c,d,e,f,g){return new google.maps.MarkerImage(a,new google.maps.Size(b,c),new google.maps.Point(d,e),new google.maps.Point(f,g))}mobserv.geolocation.watchPosition({enableHighAccuracy:!0,
timeout:1E4,maximumAge:6E4});var b=$(this),c=b.find(".item.location"),d=b.find(".mapdata"),e=b.find(".jobdata"),m=b.data("id"),g=b.data("source"),n=[],p=[mobserv.geolocation.position.latitude,mobserv.geolocation.position.longitude],h=mobserv.globals.services,k="",b=10,q=[];d.hide();e.hide();m&&"joblist"==g?q=$(h.xml).find('service[id="'+m+'"] > job'):m&&"jobdetails"==g?(h=mobserv.globals.services,q=$(h.xml).find('job[id="'+m+'"]')):"gps"==g&&(c.addClass("hilite"),b=16);n.push({latLng:p,tag:"mydevice",
events:{click:function(){$(".mapdata").trigger("tap")}},options:{icon:a("pic/marker-mobserv.png",30,30,0,0,15,15),zIndex:9,iconSize:[60,60]}});d={options:{center:p,radius:1E3,fillColor:"#F30",fillOpacity:.2,strokeColor:"#F30",strokeOpacity:0}};q.length&&q.each(function(){var b=$(this),c=b.children("location:eq(0)"),d=b.attr("id");if(c.length)if("geoposition"==c.attr("type")){var e=parseFloat(c.attr("lat")),c=parseFloat(c.attr("lng"));e&&c&&("joblist"==g?k="autofit":"jobdetails"==g&&(p=[e,c]),n.push({latLng:[e,
c],data:d,events:{click:function(){$(".jobdata").trigger("pick",[b])}},options:{icon:a("pic/marker-333333.png",30,30,0,0,15,15)}}))}else"address"==c.attr("type")&&n.push({address:c.text(),data:d,events:{click:function(){$(".jobdata").trigger("pick",[b])}},options:{icon:a("pic/marker-333333.png",30,30,0,0,15,15)}})});e={options:{center:p,zoom:b,mapTypeControl:!1,navigationControl:!1,streetViewControl:!1,scaleControl:!1,zoomControl:!1,rotateControl:!1,scrollwheel:!1},events:{dragstart:function(){c.removeClass("hilite")}}};
console.log(e);m={values:n};$(".map").gmap3({map:e,marker:m,circle:d,styledmaptype:{id:"noplaces",styles:[{featureType:"poi",stylers:[{visibility:"off"}]}],callback:function(){$(".map").gmap3("get").setMapTypeId("noplaces")}}},k)}).on("hide","#map",function(){mobserv.geolocation.clearWatch();$(".map").gmap3("destroy");$(this).find(".item.location").removeClass("hilite")}).on("tap","#map .location",function(){var a=$(this);mobserv.geolocation.panMap(!0);a.addClass("hilite")}).on("tap",".mapdata",function(){$this=
$(this);$this.closest(".view").find(".jobdata").hide();$this.is(":visible")?$this.hide():$this.show()}).on("tap",".jobdata",function(){$this=$(this);$this.closest(".view").find(".mapdata").hide();$this.is(":visible")?$this.hide():$this.show()}).on("pick",".jobdata",function(a,b){var c=$(this),d=c.closest(".view"),e=c.show().find("table"),h=b.children('layout[name="detail"]'),g=b.children("location");d.find(".mapdata").hide();c.show();h.length&&(e.html(""),h.each(function(){var a=$(this);e.append('<tr><td width="25%">'+
a.attr("label")+"</td><td><small><b>"+htmldecode(a.text())+"</b></small></td></tr>")}),g.length&&(e.append('<tr><td width="25%" colspan="2" style="text-align:center;"><br><a class="navigate">Navegar at\u00e9 aqui</a></td></tr>'),e.find(".navigate").on("tap",function(){var a=mobserv.geolocation.position;launchnavigator.navigate([a.latitude,a.longitude],"geoposition"==g.attr("type")?[g.attr("lat"),g.attr("lng")]:g.text(),function(){mobserv.log({type:"notice",name:"launchnavigator.navigate",message:"launchnavigator has called successful"})},
function(a){mobserv.log({type:"error",name:"launchnavigator.navigate",message:a})})})));c.find("#jobid").append(b.attr("id"));c.find("#jobid").text(b.attr("id"))});$(".section").on("scroll",function(){var a=$(this);a.scrollTop()+a.innerHeight()>=this.scrollHeight?a.addClass("scrollend"):a.removeClass("scrollend")});window.addEventListener("error",function(a){mobserv.log({type:"error",name:"JS",title:"javascript error on "+a.filename+" ("+a.lineno+", "+a.colno+")",message:a.message});return!1},!1);
document.addEventListener("offline",function(){$(".statustripe").addClass("orange").fadeIn()},!1);document.addEventListener("online",function(){$(".statustripe").removeClass("orange").delay(1E3).fadeOut();$.each(mobserv.server.queue||[],function(a,b){mobserv.server.ajax(b);mobserv.log({type:"notice",name:"server.ajax.queue",message:"requests from queue triggered"});return!1})},!1);document.addEventListener("deviceready",function(){mobserv.device.init();mobserv.insomnia.init();mobserv.battery.init();
mobserv.keyboard.init();mobserv.bgmode.init();mobserv.notification.init();mobserv.menubutton.init();mobserv.backbutton.init();mobserv.geolocation.autoPosition();mobserv.sqlite.init();mobserv.auth.init()},!1);setTimeout(function(){mobserv.device.ready||(mobserv.debug.on(),mobserv.device.init(),mobserv.battery.init(),mobserv.geolocation.autoPosition(),mobserv.sqlite.init(),mobserv.auth.init())},1E3)});